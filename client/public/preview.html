<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multi-Language Code Visualizer (Cropped Top & Bottom)</title>
  <style>
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      margin-bottom: 15px;
      gap: 10px;
    }
    label {
      font-weight: bold;
      margin-right: 5px;
    }
    select,
    button,
    input {
      font-size: 1rem;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    input[type="number"] {
      width: 120px;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    textarea {
      width: 100%;
      height: 200px;
      font-family: monospace;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      resize: vertical;
    }

    /* ‚úÖ Wrapper crops both top and bottom parts */
    .iframe-wrapper {
      width: 100%;
      height: 60vh;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 15px;
      overflow: hidden;
      position: relative;
    }

    iframe {
      width: 100%;
      height: calc(60vh + 140px); /* slightly taller to allow cropping */
      border: none;
      position: relative;
      top: -60px;   /* crop from top ‚úÖ */
      margin-bottom: -90px; /* crop from bottom ‚úÖ */
      overflow: hidden;
    }

    iframe::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üåç Multi-Language Code Visualizer</h2>

    <div class="controls">
      <label for="langSelect">Language:</label>
      <select id="langSelect" onchange="setLanguage(this.value)">
        <option value="py3">Python 3</option>
        <option value="js">JavaScript</option>
        <option value="java">Java</option>
        <option value="cpp">C++</option>
        <option value="c">C</option>
        <option value="ruby">Ruby</option>
        <option value="ts">TypeScript</option>
      </select>

      <label for="stepInput">Stop at step #:</label>
      <input type="number" id="stepInput" min="0" placeholder="e.g. 5" />

      <button onclick="visualizeCode()">‚ñ∂Ô∏è Visualize</button>
    </div>

    <textarea id="myCode"></textarea>

    <!-- ‚úÖ Cropped iframe wrapper -->
    <div class="iframe-wrapper">
      <iframe id="tutorFrame" src="about:blank" scrolling="no"></iframe>
    </div>
  </div>

  <script>
  const sampleCode = {
    py3: `def greet(name):\n    print(f"Hello, {name}!")\n    for i in range(3):\n        print("Step", i)\n\ngreet("World")`,
    js: `function greet(name) {\n  console.log("Hello, " + name);\n  for (let i=0; i<3; i++) console.log("Step", i);\n}\ngreet("World");`,
    java: `public class Main {\n  public static void main(String[] args) {\n    System.out.println("Hello, World!");\n    for(int i=0;i<3;i++) System.out.println("Step "+i);\n  }\n}`,
    cpp: `#include <iostream>\nusing namespace std;\nint main() {\n  cout << "Hello, World!" << endl;\n  for(int i=0;i<3;i++) cout << "Step " << i << endl;\n  return 0;\n}`,
    c: `#include <stdio.h>\nint main() {\n  printf("Hello, World!\\n");\n  for(int i=0;i<3;i++) printf("Step %d\\n", i);\n  return 0;\n}`,
    ruby: `def greet(name)\n  puts "Hello, #{name}!"\n  3.times do |i|\n    puts "Step #{i}"\n  end\nend\ngreet("World")`,
    ts: `function greet(name: string): void {\n  console.log("Hello, " + name);\n  for(let i=0;i<3;i++) console.log("Step", i);\n}\ngreet("World");`
  };

  const baseUrls = {
    py3: "https://pythontutor.com/visualize.html",
    js: "https://pythontutor.com/javascript.html",
    java: "https://pythontutor.com/java.html",
    cpp: "https://pythontutor.com/cpp.html",
    c: "https://pythontutor.com/c.html",
    ruby: "https://pythontutor.com/ruby.html",
    ts: "https://pythontutor.com/typescript.html"
  };

  let currentLang = "py3";

  function setLanguage(lang) {
    currentLang = lang;
    document.getElementById("myCode").value = sampleCode[lang];
  }

  function visualizeCode() {
    const code = encodeURIComponent(document.getElementById("myCode").value);
    const stopStep = document.getElementById("stepInput").value.trim();
    let url = baseUrls[currentLang];

    if (currentLang === "py3") {
      url += "#code=" + code + "&py=3";
    } else {
      url += "#code=" + code;
    }

    url += "&mode=display&origin=embed&cumulative=false";

    if (stopStep !== "" && !isNaN(stopStep)) {
      url += "&curInstr=" + parseInt(stopStep);
    } else {
      url += "&curInstr=0";
    }

    document.getElementById("tutorFrame").src = url;
  }

  // üß† Auto-load code + language from localStorage
  window.onload = function () {
    const savedCode = localStorage.getItem("previewCode");
    const savedLang = localStorage.getItem("previewLang");

    if (savedCode) {
      document.getElementById("myCode").value = savedCode;

      // Determine language
      if (savedLang) {
        // convert editor‚Äôs format (python3 ‚Üí py3, g++ ‚Üí cpp)
        if (savedLang === "python3" || savedLang === "python") currentLang = "py3";
        else if (savedLang === "g++" || savedLang === "cpp") currentLang = "cpp";
        else if (savedLang === "javascript" || savedLang === "node") currentLang = "js";
        else currentLang = "py3";
      } else {
        // fallback detection based on code content
        if (savedCode.includes("#include")) currentLang = "cpp";
        else if (savedCode.includes("print(")) currentLang = "py3";
        else if (savedCode.includes("console.log")) currentLang = "js";
      }

      document.getElementById("langSelect").value = currentLang;
    } else {
      setLanguage("py3"); // default
    }

    visualizeCode(); // run visualization immediately
  };
</script>

</body>
</html>